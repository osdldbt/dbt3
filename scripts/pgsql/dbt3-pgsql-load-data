#!/bin/sh
#
# This file is released under the terms of the Artistic License.
# Please see the file LICENSE, included in this package, for details.
#
# Copyright (C) 2002-2008 Open Source Development Labs, Inc.
#               2002-2014 Mark Wong
#               2014      2ndQuadrant, Ltd.

DIR=`dirname $0`
. ${DIR}/pgsql_profile || exit 1

load_table() {
	table=${1}
	file=${table}.tbl

	${PSQL} << __EOF__
COPY ${table} FROM '${DBDATA}/${file}' USING DELIMITERS '|';
__EOF__
}

if [ -z ${DBNAME} ]; then
    echo "DBNAME not defined."
    exit 1
fi

USE_TABLESPACES=0
while getopts "bd:l:t" OPT; do
	case ${OPT} in
	d)
		DBDATA=${OPTARG}
		;;
	l)
		PORT=${OPTARG}
		;;
	t)
		USE_TABLESPACES=1
		;;
	esac
done

if [ ! "x${PORT}" = "x" ]; then
	PORTARG="-p ${PORT}"
fi
PSQL="psql -X -p ${DBPORT} -d ${SID}"

load_table supplier &
load_table part &
load_table partsupp &
load_table customer &
load_table orders &
load_table lineitem &
load_table nation &
load_table region &

wait
